services:
  psinode:
    image: "${PSINODE_IMAGE}"
    user: root
    ports:
      - '8080:8080'
    ulimits:
      memlock: -1
    command: [
      "db",
      "-p", "${PRODUCER_NAME}",
      "-o", "${HOST}",
      "--p2p",
      "--admin-authz=rw:ip:${MY_IP}",
      "--database-cache-size=${DB_CACHE_SIZE}",
      "--pkcs11-module=/usr/lib/softhsm/libsofthsm2.so"
    ]
    volumes:
      - type: volume
        source: psinode-volume
        target: /root/
      - type: volume
        source: softhsm-keys
        target: /var/lib/softhsm/tokens
      - type: bind
        source: ./psinode/psinode_db/config
        target: /root/psibase/psinode_db/config
    networks:
      - psibase_net

volumes:
  psinode-volume:

networks:
  psibase_net:
    driver: bridge 